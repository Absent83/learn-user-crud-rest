<!doctype html>
<html lang="en"
      layout:decorate="default" th:with="currentSidebar='admin'"
      xmlns:layout="http://www.thymeleaf.org/" xmlns:th="http://www.thymeleaf.org">

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>

    <title>Admin page</title>
</head>


<body>
<div layout:fragment="content">
    <h1 class="page-header">Admin panel</h1>

    <ul class="nav nav-tabs">

        <li class="active">
            <a data-toggle="tab"
               href="#start">
                Users table
                <span class="sr-only" th:if="${currentAdminBar == 'list'}">(current)</span>
            </a>
        </li>


        <li th:classappend="${currentAdminBar == 'newuser'} ? 'active'">
            <a data-toggle="tab"
               href="#form">
                New User
                <span class="sr-only" th:if="${currentAdminBar == 'newuser'}">(current)</span>
            </a>
        </li>
    </ul>

    <div class="tab-content">
        <div class="tab-pane active" id="start">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4>All users</h4>
                </div>
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                            <tr>
                                <th>Id</th>
                                <th>Login</th>
                                <th>Name</th>
                                <th>E-mail</th>
                                <th>Roles</th>
                                <th>Password</th>
                                <th></th>
                                <th></th>
                            </tr>
                            </thead>
                            <tbody>
                            <th:block th:each="user:${usersFromServer}">
                                <tr>
                                    <td th:text="${user.getId()}">
                                    </td>
                                    <td th:text="${user.getUsername()}">
                                    </td>
                                    <td th:text="${user.getFirstName()}">
                                    </td>
                                    <td th:text="${user.getEmail()}">
                                    </td>
                                    <td>
                                        <th:block th:each="role:${user.getRoles()}">
                                            <p th:text="${role.getAuthority()}"></p>
                                        </th:block>
                                    </td>
                                    <td th:text="${user.getPassword()}">
                                    </td>
                                    <td>
                                        <!-- Trigger the modal with a button -->
                                        <button class="btn btn-primary" data-target="#usereditmodal" data-toggle="modal"
                                                th:attrappend="data-target=${user.getId()}" type="button">Edit
                                        </button>

                                        <!-- Modal -->
                                        <div class="modal fade" id="usereditmodal" role="dialog"
                                             th:attrappend="id=${user.getId()}">
                                            <div class="modal-dialog">

                                                <!-- Modal content-->
                                                <div class="modal-content">
                                                    <div th:replace="edit::useredit(currentuser=${user},rolesFromServer=${rolesFromServer})"></div>
                                                </div>

                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <form>
                                            <button class="btn btn-danger" formaction="/users/delete" formmethod="post"
                                                    name="userId"
                                                    th:value="${user.getId()}" type="submit">
                                                Delete
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            </th:block>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="tab-pane" id="form">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4>Add new user</h4>
                </div>
                <div class="panel-body">
                    <form
                            action="/users/add"
                            method="post">

                        <div class="form-group col-xs-offset-4 col-xs-4 text-center">
                            <label for="username">Login:</label>
                            <input class="form-control" id="username" name="username" placeholder="Enter login" required
                                   type="text">
                        </div>
                        <div class="form-group col-xs-offset-4 col-xs-4 text-center">
                            <label for="firstName">Name:</label>
                            <input class="form-control" id="firstName" name="firstName" placeholder="Enter name"
                                   required
                                   type="text">
                        </div>
                        <div class="form-group col-xs-offset-4 col-xs-4 text-center">
                            <label for="email">E-mail:</label>
                            <input class="form-control" id="email" name="email" placeholder="Enter email" required
                                   type="email">
                        </div>
                        <div class="form-group col-xs-offset-4 col-xs-4 text-center">
                            <label for="password">Password</label>
                            <input class="form-control" id="password" name="password" placeholder="Enter password"
                                   required
                                   type="password">
                        </div>
                        <div class="form-group col-xs-offset-4 col-xs-4 text-center">
                            <label for="roles">Role:</label>
                            <select class="form-control" id="roles" multiple name="roles" required>
                                <th:block th:each="role : ${rolesFromServer}">

                                    <option name="id"
                                            th:text="${role.getAuthority()}"
                                            th:value="${role.getId()}">
                                    </option>

                                </th:block>
                            </select>
                        </div>
                        <div class="form-group col-xs-offset-4 col-xs-4 text-center">
                            <button class="btn btn-success" type="submit">Add new user</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

    </div>
</div>
</body>

</html>
